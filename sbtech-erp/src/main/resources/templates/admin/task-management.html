<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="content">

    <link rel="stylesheet" th:href="@{/css/admin/task-management.css}"/>

    <!-- ğŸ”¹ í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <h1>ì—…ë¬´ ê´€ë¦¬</h1>
        <button class="btn-assign" onclick="openTaskModal()">+ ì—…ë¬´ ë°°ì •</button>
    </div>

    <!-- ğŸ”¹ í†µê³„ -->
    <div class="card stats-card">
        â³ ì§„í–‰ì¤‘: <b id="inProgressCount">0ê±´</b> /
        ğŸ•’ ëŒ€ê¸°: <b id="pendingCount">0ê±´</b> /
        âœ… ì™„ë£Œ: <b id="doneCount">0ê±´</b>
    </div>

    <!-- ğŸ”¹ ì—…ë¬´ ë¦¬ìŠ¤íŠ¸ -->
    <div class="table-card">
        <table>
            <thead>
            <tr>
                <th>ì—…ë¬´ëª…</th>
                <th>ë‹´ë‹¹ì</th>
                <th>ë§ˆê°ì¼</th>
                <th>ìƒíƒœ</th>
                <th>ì‘ì—…</th>
            </tr>
            </thead>
            <tbody id="taskTable"></tbody>
        </table>
    </div>

    <button onclick="downloadExcel()">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>

    <!-- ğŸ”¹ ì—…ë¬´ ë°°ì • ëª¨ë‹¬ -->
    <div class="modal-bg" id="taskModal">
        <div class="modal">
            <h2>ì—…ë¬´ ë°°ì •</h2>

            <label>ì—…ë¬´ëª…</label>
            <input id="taskTitle" type="text" placeholder="ì˜ˆ: ì‹ ê·œ ê³ ê° ë°œêµ´">

            <label>ë‹´ë‹¹ì</label>
            <select id="assigneeSelect"></select>

            <label>ë§ˆê°ì¼</label>
            <input id="dueDate" type="date">

            <label>ìƒíƒœ</label>


            <button class="save-btn" onclick="assignTask()">ë°°ì • ì™„ë£Œ</button>
            <button class="cancel-btn" onclick="closeTaskModal()">ì·¨ì†Œ</button>
        </div>
    </div>

    <script th:src="@{/js/admin/task-management.js}"></script>

    <script>
        function downloadExcel() {
            const token = localStorage.getItem("accessToken");

            fetch("/erp/api/v1/task/excel", {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            })
                .then(res => res.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "my_tasks.xlsx";
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                });
        }
    </script>
</th:block>
</html>
